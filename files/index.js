var S={init:function(){var t=window.location.href,e=t.indexOf("?a=");S.Drawing.init(".canvas"),document.body.classList.add("body--ready"),-1!==e?S.UI.simulate(decodeURI(t).substring(e+3)):S.UI.simulate("I...|am|Xecades|Welcome|To My Blog|#countdown 3"),S.Drawing.loop(function(){S.Shape.render()})}};S.Drawing=function(){var e,i,n;return requestFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},{init:function(t){e=document.querySelector(t),i=e.getContext("2d"),this.adjustCanvas(),window.addEventListener("resize",function(t){S.Drawing.adjustCanvas()})},loop:function(t){n=n||t,this.clearFrame(),n(),requestFrame.call(window,this.loop.bind(this))},adjustCanvas:function(){e.width=window.innerWidth,e.height=window.innerHeight},clearFrame:function(){i.clearRect(0,0,e.width,e.height)},getArea:function(){return{w:e.width,h:e.height}},drawCircle:function(t,e){i.fillStyle=e.render(),i.beginPath(),i.arc(t.x,t.y,t.z,0,2*Math.PI,!0),i.closePath(),i.fill()}}}(),S.UI=function(){var a,r,s,o=document.querySelector(".ui-input"),e=document.querySelector(".ui"),t=document.querySelector(".help"),i=document.querySelector(".commands"),h=document.querySelector(".overlay"),n=document.querySelector(".canvas"),c=!1,l=30,d=!0,u=[],f="#";function w(t){var e;return t.getHours()+":"+(e=(e=t.getMinutes())<10?"0"+e:e)}function m(t,e,i,n){clearInterval(a),t(r=n?i:1),(!i||!n&&r<i||n&&0<r)&&(a=setInterval(function(){t(r=n?r-1:r+1),(!n&&i&&r===i||n&&0===r)&&clearInterval(a)},e))}function p(t){clearInterval(a),u=[],s=null,t&&S.Shape.switchShape(S.ShapeBuilder.letter(""))}function v(i){var n,a;h.classList.remove("overlay--visible"),u="object"==typeof i?i:u.concat(i.split("|")),o.value="",g(),m(function(t){switch(a=u.shift(),n=function(t){return(t=t&&t.split(" ")[0])&&t[0]===f&&t.substring(1)}(a),i=function(t){return t&&t.split(" ")[1]}(a),n){case"countdown":m(function(t){0===t?0===u.length?S.Shape.switchShape(S.ShapeBuilder.letter("")):v(u):S.Shape.switchShape(S.ShapeBuilder.letter(t),!0)},1e3,i=0<(i=parseInt(i)||10)?i:10,!0);break;case"rectangle":i=(i=i&&i.split("x"))&&2===i.length?i:[l,l/2],S.Shape.switchShape(S.ShapeBuilder.rectangle(Math.min(l,parseInt(i[0])),Math.min(l,parseInt(i[1]))));break;case"circle":i=parseInt(i)||l,i=Math.min(i,l),S.Shape.switchShape(S.ShapeBuilder.circle(i));break;case"time":var e=w(new Date);0<u.length?S.Shape.switchShape(S.ShapeBuilder.letter(e)):m(function(){(e=w(new Date))!==s&&(s=e,S.Shape.switchShape(S.ShapeBuilder.letter(s)))},1e3);break;default:S.Shape.switchShape(S.ShapeBuilder.letter(a[0]===f?"What?":a))}},2e3,u.length)}function g(t){18<o.value.length?e.classList.add("ui--wide"):e.classList.remove("ui--wide"),d&&0<o.value.length?e.classList.add("ui--enter"):e.classList.remove("ui--enter")}return document.body.addEventListener("keydown",function(t){o.focus(),13===t.keyCode&&(d=!1,p(),v(o.value))}),o.addEventListener("input",g),o.addEventListener("change",g),o.addEventListener("focus",g),t.addEventListener("click",function(t){h.classList.toggle("overlay--visible"),h.classList.contains("overlay--visible")&&p(!0)}),i.addEventListener("click",function(t){var e,i,n;i=(e=t.target.classList.contains("commands-item")?t.target:t.target.parentNode.classList.contains("commands-item")?t.target.parentNode:t.target.parentNode.parentNode)&&e.querySelector(".commands-item-info"),n=e&&i.getAttribute("data-demo"),e&&i.getAttribute("data-url"),i&&(h.classList.remove("overlay--visible"),n&&(o.value=n,c?(p(),v(o.value)):o.focus()))}),n.addEventListener("click",function(t){h.classList.remove("overlay--visible")}),o.focus(),c&&document.body.classList.add("touch"),{simulate:function(t){v(t)}}}(),S.UI.Tabs=function(){document.querySelector(".tabs");var t=document.querySelector(".tabs-labels"),a=document.querySelectorAll(".tabs-label"),r=document.querySelectorAll(".tabs-panel");function s(t){a[t].classList.add("tabs-label--active"),r[t].classList.add("tabs-panel--active")}s(0),t.addEventListener("click",function(t){var e,i=t.target;if(i.classList.contains("tabs-label")){for(var n=0;n<a.length;n++)a[n].classList.remove("tabs-label--active"),r[n].classList.remove("tabs-panel--active"),i===a[n]&&(e=n);s(e)}})}(),S.Point=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.a=t.a,this.h=t.h},S.Color=function(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n},S.Color.prototype={render:function(){return"rgba("+this.r+","+ +this.g+","+this.b+","+this.a+")"}},S.Dot=function(t,e){this.p=new S.Point({x:t,y:e,z:5,a:1,h:0}),this.e=.07,this.s=!0,this.c=new S.Color(255,255,255,this.p.a),this.t=this.clone(),this.q=[]},S.Dot.prototype={clone:function(){return new S.Point({x:this.x,y:this.y,z:this.z,a:this.a,h:this.h})},_draw:function(){this.c.a=this.p.a,S.Drawing.drawCircle(this.p,this.c)},_moveTowards:function(t){var e=this.distanceTo(t,!0),i=e[0],n=e[1],a=e[2],r=this.e*a;if(-1===this.p.h)return this.p.x=t.x,this.p.y=t.y,!0;if(1<a)this.p.x-=i/a*r,this.p.y-=n/a*r;else{if(!(0<this.p.h))return!0;this.p.h--}return!1},_update:function(){if(this._moveTowards(this.t)){var t=this.q.shift();t?(this.t.x=t.x||this.p.x,this.t.y=t.y||this.p.y,this.t.z=t.z||this.p.z,this.t.a=t.a||this.p.a,this.p.h=t.h||0):this.s?(this.p.x-=Math.sin(3.142*Math.random()),this.p.y-=Math.sin(3.142*Math.random())):this.move(new S.Point({x:this.p.x+50*Math.random()-25,y:this.p.y+50*Math.random()-25}))}d=this.p.a-this.t.a,this.p.a=Math.max(.1,this.p.a-.05*d),d=this.p.z-this.t.z,this.p.z=Math.max(1,this.p.z-.05*d)},distanceTo:function(t,e){var i=this.p.x-t.x,n=this.p.y-t.y,a=Math.sqrt(i*i+n*n);return e?[i,n,a]:a},move:function(t,e){(!e||e&&1<this.distanceTo(t))&&this.q.push(t)},render:function(){this._update(),this._draw()}},S.ShapeBuilder=function(){var o=13,a=document.createElement("canvas"),r=a.getContext("2d");function t(){a.width=Math.floor(window.innerWidth/o)*o,a.height=Math.floor(window.innerHeight/o)*o,r.fillStyle="red",r.textBaseline="middle",r.textAlign="center"}function s(){var t=r.getImageData(0,0,a.width,a.height).data;dots=[],x=0,y=0,fx=a.width,fy=a.height,w=0;for(var e=h=0;e<t.length;e+=4*o)0<t[e+3]&&(dots.push(new S.Point({x:x,y:y})),w=x>w?x:w,h=y>h?y:h,fx=x<fx?x:fx,fy=y<fy?y:fy),x+=o,x>=a.width&&(x=0,y+=o,e+=4*o*a.width);return{dots:dots,w:w+fx,h:h+fy}}function e(t){r.font="bold "+t+"px Avenir, Helvetica Neue, Helvetica, Arial, sans-serif"}return t(),window.addEventListener("resize",t),{imageFile:function(t,e){var i=new Image,n=S.Drawing.getArea();i.onload=function(){r.clearRect(0,0,a.width,a.height),r.drawImage(this,0,0,.6*n.h,.6*n.h),e(s())},i.onerror=function(){e(S.ShapeBuilder.letter("What?"))},i.src=t},circle:function(t){var e=Math.max(0,t)/2;return r.clearRect(0,0,a.width,a.height),r.beginPath(),r.arc(e*o,e*o,e*o,0,2*Math.PI,!1),r.fill(),r.closePath(),s()},letter:function(t){return e(500),e(Math.min(500,a.width/r.measureText(t).width*.8*500,a.height/500*(function(t){return!isNaN(parseFloat(t))&&isFinite(t)}(t)?1:.45)*500)),r.clearRect(0,0,a.width,a.height),r.fillText(t,a.width/2,a.height/2),s()},rectangle:function(t,e){for(var i=[],n=o*t,a=o*e,r=0;r<a;r+=o)for(var s=0;s<n;s+=o)i.push(new S.Point({x:s,y:r}));return{dots:i,w:n,h:a}}}}(),S.Shape=function(){var s=[],o=0,h=0,c=0,l=0;return{shuffleIdle:function(){for(var t=S.Drawing.getArea(),e=0;e<s.length;e++)s[e].s||s[e].move({x:Math.random()*t.w,y:Math.random()*t.h})},switchShape:function(t,e){var i,n=S.Drawing.getArea();if(o=t.w,h=t.h,function(){var t=S.Drawing.getArea();c=t.w/2-o/2,l=t.h/2-h/2}(),t.dots.length>s.length){i=t.dots.length-s.length;for(var a=1;a<=i;a++)s.push(new S.Dot(n.w/2,n.h/2))}a=0;for(var r=0;0<t.dots.length;)r=Math.floor(Math.random()*t.dots.length),s[a].e=e?.25:s[a].s?.14:.11,s[a].s?s[a].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:18})):s[a].move(new S.Point({z:5*Math.random()+5,h:e?18:30})),s[a].s=!0,s[a].move(new S.Point({x:t.dots[r].x+c,y:t.dots[r].y+l,a:1,z:5,h:0})),t.dots=t.dots.slice(0,r).concat(t.dots.slice(r+1)),a++;for(r=a;r<s.length;r++)s[r].s&&(s[r].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:20})),s[r].s=!1,s[r].e=.04,s[r].move(new S.Point({x:Math.random()*n.w,y:Math.random()*n.h,a:.3,z:4*Math.random(),h:0})))},render:function(){for(var t=0;t<s.length;t++)s[t].render()}}}(),S.init();